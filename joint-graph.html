<!--
    TODO keep a track of the number of nodes excluding cf and on the blocked mobilities when we add a link
-->

<!doctype html>
<html>
<head>
    <title>Graph</title>
    <!--from the web-->
    <script src='js/lib/cytoscape.min.js'></script>
    <script src='js/lib/math.js'></script>
    <script src='js/lib/nerdamer-all.min.js'></script>    

    <!--Use a predefined example-->
    <!--<script src='examples/hyperstaticModel2.js'></script>-->
    <script src='examples/complexeHyperstaticModel.js'></script>

    <!-- code from this project-->
    <script src='js/graph/find_cycles.js'></script>
    <script src='js/graph/computecycles.js'></script>
    <script src='js/graph/export.js'></script>
    <script src='js/graph/component.js'></script>
    <script src='js/graph/mech.js'></script>
    <script src='js/graph/mechmath.js'></script>
    <script src='js/graph/hyperstatism.js'></script>
    <script src='js/graph/ui.js'></script>
    <script src='js/sidebar.js'></script>
    <script src='translation/translation.js'></script>
    <script src='js/calculator.js'></script>
    <link rel="stylesheet" type="text/css" href="css/cytoscape.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css">
    <meta charset="UTF-8">

</head>
<!--side calculator-->
<iframe src="htmlBricks/sideCalculator.html" id="embed_calculator" width="305" height="500" scrolling="no" frameBorder="0"></iframe>
<input type="button" id="calculator_button" value="" onclick="toggleCalculator()">
<!--discord-->
<a href="https://discord.com/channels/957674596545495101/957674597006843985" target="_blank" id="discord_link"><img src="img/discord.png" alt="discord"></a>

<body>
    <!-- TOPBAR -->
    <iframe id="help" src="htmlBricks/topBar.html?gitRepo=https://github.com/guillaume55/MecaWeb&download=https://guillaume55.github.io/MecaWeb/cuts.html&helpPage=https://copo.app/index.php/graph-liaison/" height="50px" width="100%" frameborder="0"></iframe>

    <!-- SIDEBAR -->
    <div id="mySidebar" class="sidebar">
        <div id="sidebar-btn" onclick="toggleSidebar()">â˜°</div>
        <div id="sidebar-content"></div>
        <script>appendToSidebar("sidebar-content");</script>
    </div>

    <div id="main">
        <div id="cy"></div>
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'anode')">{Sub-assemblies}</button>
            <button class="tablinks" onclick="openTab(event, 'alink')">{Links}</button>
            <button class="tablinks" onclick="openTab(event, 'edit')">{Edit}</button>
            <button class="tablinks" onclick="openTab(event, 'export')">{Export}</button>
            <button class="tablinks" onclick="openTab(event, 'hyperstatism')">{Hyperstatism}</button>
        </div>

        <div id="alink" class="tabcontent"></div>
        <div id="anode" class="tabcontent"></div>
        <div id="edit" class="tabcontent"></div>
        <div id="export" class="tabcontent"></div>
        <div id="hyperstatism" class="tabcontent">
            <button onclick="findCyclesAndCheckHyperstaticity()">{Check hyperstatism}</button><br>
            <div id="hyperstatismDiv"></div>
        </div>
    </div>
    
    <script>
        
        var graph = []

        var cy;
        function create_cytoscape(){
            cy = cy_create(document.getElementById('cy'))
            comp_sLink(document.getElementById('alink'),"sa1 sa2 name")
            comp_sNode(document.getElementById('anode'))
            edit_tab(document.getElementById('edit'), undefined)
            export_button(document.getElementById('export'))

            cy.on('tap', 'node', function(evt){
                var node = evt.target;
                openTab(event, 'edit')
                console.log( 'clicked ' + node.id() );
                edit_tab(document.getElementById('edit'), node.id())
            });
            cy.on('tap', 'edge', function(evt){
                var edge = evt.target;
                openTab(event, 'edit')
                console.log( 'clicked ' + edge.id() );
                edit_tab(document.getElementById('edit'), edge.id())
            });

            
        }
        
        create_cytoscape()

        function findCyclesAndCheckHyperstaticity(){
            console.log("Checking hyperstaticity")
            let cycles = findCycles() 
            
            //let equations = writeRawEquations(cycles)

            //console.log("cycles", cycles, "equation", equations)
            //findHyperstatisms(equations)
            processHyperstatism(cycles)
        }

        findCyclesAndCheckHyperstaticity()
        /*cy.pan({
        x: 100,
        y: 100
        });*/


    </script>
</body>
</html>
